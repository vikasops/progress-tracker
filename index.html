<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Preparation Tracker - Admin Panel</title>
    <!-- Firebase SDK v9 (latest stable) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
:root {
  --color-primary: #2563eb;
  --color-primary-light: #3b82f6;
  --color-primary-dark: #1d4ed8;
  --color-secondary: #64748b;
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-danger: #ef4444;
  --color-background: #f8fafc;
  --color-surface: #ffffff;
  --color-border: #e2e8f0;
  --color-text: #1e293b;
  --color-text-muted: #64748b;
  --color-admin: #7c3aed;
  --color-admin-light: #8b5cf6;
  --border-radius: 8px;
  --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
  --transition: all 0.2s ease-in-out;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  line-height: 1.6;
  color: var(--color-text);
  background-color: var(--color-background);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

/* Header */
.header {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: 1rem 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
}

.header.admin {
  background: linear-gradient(135deg, var(--color-admin) 0%, var(--color-admin-light) 100%);
  color: white;
}

.header.admin .header__title {
  color: white;
}

.header .container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.header__title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-primary);
  text-decoration: none;
}

.header__nav {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.header__user-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 0.875rem;
  color: var(--color-text-muted);
}

.header.admin .header__user-info {
  color: rgba(255, 255, 255, 0.9);
}

.header__controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
}

.admin-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.75rem;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
}

.sync-status {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 500;
}

.sync-status.synced {
  background: rgba(16, 185, 129, 0.1);
  color: var(--color-success);
}

.sync-status.syncing {
  background: rgba(245, 158, 11, 0.1);
  color: var(--color-warning);
}

.sync-status.error {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-danger);
}

/* Admin Navigation */
.admin-nav {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: 0.5rem 0;
}

.admin-nav .container {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
}

.admin-nav-item {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius);
  text-decoration: none;
  color: var(--color-text-muted);
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
  transition: var(--transition);
  border: 1px solid transparent;
}

.admin-nav-item:hover,
.admin-nav-item.active {
  background: var(--color-admin);
  color: white;
  border-color: var(--color-admin);
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: var(--transition);
  white-space: nowrap;
  text-align: center;
  justify-content: center;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn--sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.8rem;
}

.btn--lg {
  padding: 0.75rem 1.5rem;
  font-size: 1rem;
}

.btn--primary {
  background: var(--color-primary);
  color: white;
}

.btn--primary:hover:not(:disabled) {
  background: var(--color-primary-dark);
}

.btn--admin {
  background: var(--color-admin);
  color: white;
}

.btn--admin:hover:not(:disabled) {
  background: var(--color-admin-light);
}

.btn--secondary {
  background: var(--color-secondary);
  color: white;
}

.btn--secondary:hover:not(:disabled) {
  background: #475569;
}

.btn--outline {
  background: transparent;
  color: var(--color-primary);
  border: 1px solid var(--color-primary);
}

.btn--outline:hover:not(:disabled) {
  background: var(--color-primary);
  color: white;
}

.btn--outline-danger {
  background: transparent;
  color: var(--color-danger);
  border: 1px solid var(--color-danger);
}

.btn--outline-danger:hover:not(:disabled) {
  background: var(--color-danger);
  color: white;
}

.btn--ghost {
  background: transparent;
  color: var(--color-text-muted);
  padding: 0.5rem;
}

.btn--ghost:hover:not(:disabled) {
  background: var(--color-border);
  color: var(--color-text);
}

/* Landing Page */
.landing {
  min-height: calc(100vh - 120px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 4rem 0;
}

.landing__content {
  text-align: center;
  max-width: 600px;
}

.landing__title {
  font-size: 3rem;
  font-weight: 800;
  color: var(--color-text);
  margin-bottom: 1rem;
  line-height: 1.2;
}

.landing__subtitle {
  font-size: 1.25rem;
  color: var(--color-text-muted);
  margin-bottom: 2rem;
  line-height: 1.5;
}

.landing__features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
  margin: 3rem 0;
}

.feature {
  text-align: center;
}

.feature__icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.feature__title {
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--color-text);
}

.feature__description {
  font-size: 0.875rem;
  color: var(--color-text-muted);
}

/* Auth Modal */
.auth-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.auth-modal.hidden {
  display: none;
}

.auth-form {
  background: white;
  padding: 2rem;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-lg);
  width: 100%;
  max-width: 400px;
  margin: 1rem;
  position: relative;
}

.auth-form h2 {
  margin-bottom: 1.5rem;
  text-align: center;
  color: var(--color-text);
  font-size: 1.5rem;
  font-weight: 600;
}

.form-group {
  margin-bottom: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--color-text);
  font-size: 0.875rem;
}

.form-control {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 1rem;
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.error {
  color: var(--color-danger);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.75rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--border-radius);
  border: 1px solid rgba(239, 68, 68, 0.2);
}

.success {
  color: var(--color-success);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.75rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: var(--border-radius);
  border: 1px solid rgba(16, 185, 129, 0.2);
}

.auth-switch {
  text-align: center;
  margin-top: 1.5rem;
  font-size: 0.875rem;
  padding-top: 1rem;
  border-top: 1px solid var(--color-border);
  color: var(--color-text-muted);
}

.auth-switch button {
  background: none;
  border: none;
  color: var(--color-primary);
  cursor: pointer;
  font-weight: 500;
  text-decoration: none;
  margin-left: 0.25rem;
}

.auth-switch button:hover {
  text-decoration: underline;
}

.close-modal {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  color: var(--color-text-muted);
  cursor: pointer;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.close-modal:hover {
  background: var(--color-border);
}

/* Main Content */
.main {
  padding: 2rem 0;
  min-height: calc(100vh - 200px);
}

/* Cards */
.card {
  background: var(--color-surface);
  border-radius: var(--border-radius);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
}

.card__header {
  padding: 1.25rem;
  border-bottom: 1px solid var(--color-border);
}

.card__body {
  padding: 1.25rem;
}

/* Admin Dashboard */
.admin-dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: var(--color-surface);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow);
}

.stat-card__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.stat-card__title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.stat-card__icon {
  font-size: 1.5rem;
}

.stat-card__value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: 0.5rem;
}

.stat-card__description {
  font-size: 0.875rem;
  color: var(--color-text-muted);
}

/* Admin Tables */
.admin-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.admin-table th,
.admin-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid var(--color-border);
}

.admin-table th {
  background: var(--color-background);
  font-weight: 600;
  font-size: 0.875rem;
  color: var(--color-text);
}

.admin-table td {
  font-size: 0.875rem;
}

.admin-table tr:hover {
  background: rgba(37, 99, 235, 0.02);
}

/* Topic Management */
.topic-manager {
  background: var(--color-surface);
  border-radius: var(--border-radius);
  border: 1px solid var(--color-border);
  margin-bottom: 2rem;
}

.topic-manager__header {
  padding: 1.25rem;
  border-bottom: 1px solid var(--color-border);
  display: flex;
  justify-content: between;
  align-items: center;
  gap: 1rem;
}

.topic-manager__body {
  padding: 1.25rem;
}

.topic-form {
  display: grid;
  gap: 1rem;
  margin-bottom: 2rem;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.subtopic-list {
  margin-top: 1rem;
}

.subtopic-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background: var(--color-background);
  border-radius: var(--border-radius);
  margin-bottom: 0.5rem;
}

.subtopic-item:last-child {
  margin-bottom: 0;
}

/* Progress Overview */
.progress-overview h2 {
  margin-bottom: 1rem;
  color: var(--color-text);
  font-size: 1.25rem;
  font-weight: 600;
}

.progress-bar-container {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.progress-bar {
  flex: 1;
  height: 12px;
  background-color: var(--color-border);
  border-radius: 6px;
  overflow: hidden;
}

.progress-bar__fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-success) 0%, var(--color-primary) 100%);
  transition: width 0.3s ease;
  width: 0%;
}

.progress-percentage {
  font-weight: 600;
  font-size: 1.1rem;
  color: var(--color-primary);
  min-width: 4rem;
}

.progress-stats {
  display: flex;
  justify-content: space-between;
  font-size: 0.875rem;
  color: var(--color-text-muted);
}

/* Search */
.search-section {
  margin-bottom: 2rem;
}

/* Topic Sections */
.topic-section {
  margin-bottom: 1rem;
}

.topic-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: var(--transition);
  padding: 1rem 1.25rem;
}

.topic-header:hover {
  background-color: rgba(37, 99, 235, 0.02);
}

.topic-header__left {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex: 1;
}

.topic-header__right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.topic-toggle {
  color: var(--color-secondary);
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.topic-toggle:hover {
  background: var(--color-border);
}

.topic-toggle[aria-expanded="true"] .chevron-icon {
  transform: rotate(90deg);
}

.chevron-icon {
  transition: transform 0.2s ease;
  width: 20px;
  height: 20px;
}

.topic-info {
  flex: 1;
}

.topic-title {
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--color-text);
}

.topic-description {
  font-size: 0.875rem;
  color: var(--color-text-muted);
  margin: 0;
}

.progress-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.progress-circle {
  position: relative;
  width: 40px;
  height: 40px;
}

.progress-ring {
  transform: rotate(-90deg);
}

.progress-ring__circle {
  stroke: var(--color-primary);
  stroke-dasharray: 113;
  stroke-dashoffset: 113;
  transition: stroke-dashoffset 0.3s ease;
  fill: none;
}

.progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--color-primary);
}

.progress-stats-small {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

/* Topic Content */
.topic-content {
  border-top: 1px solid var(--color-border);
  padding: 0;
  display: none;
}

.subtopics-list {
  padding: 0;
}

.subtopic-item {
  padding: 1rem 1.25rem;
  border-bottom: 1px solid #f1f5f9;
  transition: var(--transition);
}

.subtopic-item:last-child {
  border-bottom: none;
}

.subtopic-item:hover {
  background-color: rgba(37, 99, 235, 0.02);
}

.subtopic-item.completed {
  background-color: rgba(16, 185, 129, 0.05);
}

.subtopic-item.completed .subtopic-name {
  text-decoration: line-through;
  color: var(--color-text-muted);
}

.subtopic-header {
  margin-bottom: 0.75rem;
}

.checkbox-label {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  cursor: pointer;
  font-size: 0.95rem;
}

.checkbox-label input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.checkbox-custom {
  width: 18px;
  height: 18px;
  border: 2px solid var(--color-border);
  border-radius: 3px;
  background: var(--color-surface);
  transition: var(--transition);
  position: relative;
  flex-shrink: 0;
  margin-top: 2px;
}

.checkbox-label input[type="checkbox"]:checked + .checkbox-custom {
  background: var(--color-success);
  border-color: var(--color-success);
}

.checkbox-label input[type="checkbox"]:checked + .checkbox-custom::after {
  content: '✓';
  position: absolute;
  color: white;
  font-size: 12px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.subtopic-name {
  flex: 1;
  font-weight: 500;
  line-height: 1.4;
}

.subtopic-comments {
  margin-left: 2.5rem;
}

.subtopic-comments textarea {
  width: 100%;
  min-height: 60px;
  padding: 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  resize: vertical;
  transition: var(--transition);
  font-family: inherit;
}

.subtopic-comments textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Footer */
.footer {
  margin-top: 4rem;
  padding: 2rem 0;
  border-top: 1px solid var(--color-border);
  background: var(--color-surface);
}

.footer-content {
  text-align: center;
  color: var(--color-text-muted);
  font-size: 0.875rem;
}

.footer-content p {
  margin-bottom: 0.5rem;
}

.footer-links a {
  color: var(--color-primary);
  text-decoration: none;
}

.footer-links a:hover {
  text-decoration: underline;
}

/* User Progress Modal */
.user-progress-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.user-progress-modal.hidden {
  display: none;
}

.user-progress-content {
  background: white;
  padding: 2rem;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-lg);
  width: 90%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
}

/* Responsive Design */
@media (max-width: 768px) {
  .landing__title {
    font-size: 2rem;
  }

  .landing__subtitle {
    font-size: 1rem;
  }

  .header .container {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }

  .header__nav {
    justify-content: center;
    flex-wrap: wrap;
  }

  .admin-dashboard {
    grid-template-columns: 1fr;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .topic-header {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }

  .topic-header__right {
    justify-content: center;
  }

  .progress-bar-container {
    flex-direction: column;
    align-items: stretch;
    gap: 0.5rem;
  }

  .progress-percentage {
    text-align: center;
  }

  .progress-stats {
    flex-direction: column;
    text-align: center;
    gap: 0.25rem;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 0 0.75rem;
  }

  .landing {
    padding: 2rem 0;
  }

  .landing__features {
    grid-template-columns: 1fr;
    gap: 1.5rem;
    margin: 2rem 0;
  }

  .header__title {
    font-size: 1.25rem;
  }

  .card__header,
  .card__body {
    padding: 1rem;
  }

  .subtopic-item {
    padding: 0.75rem 1rem;
  }

  .subtopic-comments {
    margin-left: 1.75rem;
  }

  .auth-form {
    margin: 0.5rem;
    padding: 1.5rem;
  }

  .user-progress-content {
    padding: 1rem;
    margin: 1rem;
  }
}

/* Loading Animation */
.loading {
  text-align: center;
  padding: 2rem;
  color: var(--color-text-muted);
}

/* Hidden utility */
.hidden {
  display: none !important;
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  background: var(--color-success);
  color: white;
  padding: 1rem 1.5rem;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-lg);
  z-index: 1001;
  transform: translateX(100%);
  transition: transform 0.3s ease;
}

.toast.show {
  transform: translateX(0);
}

.toast.error {
  background: var(--color-danger);
}

.toast.warning {
  background: var(--color-warning);
}
    </style>
</head>
<body>
    <!-- Authentication Modal -->
    <div class="auth-modal hidden" id="authModal">
        <div class="auth-form">
            <button class="close-modal" id="closeModal" type="button">&times;</button>
            <h2 id="authTitle">Welcome Back</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" required placeholder="Enter your password">
                </div>
                <div id="authError" class="error hidden"></div>
                <div id="authSuccess" class="success hidden"></div>
                <div class="form-group">
                    <button type="submit" class="btn btn--primary" style="width: 100%;" id="authSubmit">
                        Sign In
                    </button>
                </div>
                <div class="auth-switch">
                    <span id="authSwitchText">Don't have an account?</span>
                    <button type="button" id="authSwitchBtn">Sign Up</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Progress Modal -->
    <div class="user-progress-modal hidden" id="userProgressModal">
        <div class="user-progress-content">
            <button class="close-modal" id="closeProgressModal" type="button">&times;</button>
            <h2 id="progressModalTitle">User Progress</h2>
            <div id="progressModalContent">
                <!-- User progress content will be loaded here -->
            </div>
        </div>
    </div>

    <header class="header" id="mainHeader">
        <div class="container">
            <a href="#" class="header__title" id="homeLink">DevOps Tracker</a>
            <nav class="header__nav">
                <!-- Guest Navigation -->
                <div class="header__guest" id="guestNav">
                    <div class="header__controls">
                        <button class="btn btn--outline btn--sm" id="signInBtn">Sign In</button>
                        <button class="btn btn--primary btn--sm" id="signUpBtn">Sign Up</button>
                    </div>
                </div>

                <!-- Authenticated Navigation -->
                <div class="header__auth hidden" id="authNav">
                    <div class="header__user-info">
                        <div class="admin-badge hidden" id="adminBadge">
                            <span>👑</span>
                            <span>Admin</span>
                        </div>
                        <div class="sync-status synced" id="syncStatus">
                            <span>●</span>
                            <span>Synced</span>
                        </div>
                        <span id="userEmail"></span>
                    </div>
                    <div class="header__controls">
                        <button class="btn btn--ghost btn--sm hidden" id="expandAllBtn">
                            <span id="expandAllText">Expand All</span>
                        </button>
                        <button class="btn btn--outline btn--sm hidden" id="exportBtn">Export</button>
                        <button class="btn btn--outline-danger btn--sm" id="signOutBtn">Sign Out</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Admin Navigation -->
    <nav class="admin-nav hidden" id="adminNav">
        <div class="container">
            <a href="#" class="admin-nav-item active" id="adminDashboardTab">
                <span>📊</span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="admin-nav-item" id="adminTopicsTab">
                <span>📝</span>
                <span>Manage Topics</span>
            </a>
            <a href="#" class="admin-nav-item" id="adminUsersTab">
                <span>👥</span>
                <span>User Progress</span>
            </a>
        </div>
    </nav>

    <main>
        <!-- Landing Page -->
        <section class="landing" id="landingSection">
            <div class="container">
                <div class="landing__content">
                    <h1 class="landing__title">DevOps Preparation Tracker</h1>
                    <p class="landing__subtitle">
                        Master your DevOps interview preparation with a comprehensive tracking system 
                        covering multiple technology areas and essential topics.
                    </p>

                    <div class="landing__features">
                        <div class="feature">
                            <div class="feature__icon">📊</div>
                            <div class="feature__title">Progress Tracking</div>
                            <div class="feature__description">Visual progress indicators and completion statistics</div>
                        </div>
                        <div class="feature">
                            <div class="feature__icon">☁️</div>
                            <div class="feature__title">Cloud Sync</div>
                            <div class="feature__description">Your progress saved securely with Firebase</div>
                        </div>
                        <div class="feature">
                            <div class="feature__icon">📱</div>
                            <div class="feature__title">Multi-Device</div>
                            <div class="feature__description">Access from anywhere, any device</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 2rem;">
                        <button class="btn btn--primary btn--lg" id="getStartedBtn">Get Started</button>
                        <button class="btn btn--outline btn--lg" id="demoModeBtn">Try Demo Mode</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Dashboard -->
        <div class="main hidden" id="adminDashboard">
            <div class="container">
                <div class="admin-dashboard">
                    <div class="stat-card">
                        <div class="stat-card__header">
                            <span class="stat-card__title">Total Topics</span>
                            <span class="stat-card__icon">📝</span>
                        </div>
                        <div class="stat-card__value" id="totalTopicsCount">0</div>
                        <div class="stat-card__description">Across all categories</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card__header">
                            <span class="stat-card__title">Total Subtopics</span>
                            <span class="stat-card__icon">📋</span>
                        </div>
                        <div class="stat-card__value" id="totalSubtopicsCount">0</div>
                        <div class="stat-card__description">Individual learning items</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card__header">
                            <span class="stat-card__title">Active Users</span>
                            <span class="stat-card__icon">👥</span>
                        </div>
                        <div class="stat-card__value" id="activeUsersCount">0</div>
                        <div class="stat-card__description">With progress data</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card__header">
                            <span class="stat-card__title">Avg Completion</span>
                            <span class="stat-card__icon">📈</span>
                        </div>
                        <div class="stat-card__value" id="avgCompletionRate">0%</div>
                        <div class="stat-card__description">Across all users</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <h2>Recent User Activity</h2>
                    </div>
                    <div class="card__body">
                        <div id="recentActivity">Loading recent activity...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Topic Management -->
        <div class="main hidden" id="adminTopics">
            <div class="container">
                <div class="topic-manager">
                    <div class="topic-manager__header">
                        <h2>Topic Management</h2>
                        <button class="btn btn--admin btn--sm" id="addTopicBtn">
                            <span>+</span>
                            <span>Add New Topic</span>
                        </button>
                    </div>
                    <div class="topic-manager__body">
                        <form id="topicForm" class="topic-form hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="topicName">Topic Name</label>
                                    <input type="text" id="topicName" class="form-control" required placeholder="e.g., Docker">
                                </div>
                                <div class="form-group">
                                    <label for="topicDescription">Topic Description</label>
                                    <input type="text" id="topicDescription" class="form-control" required placeholder="e.g., Container Technology">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="subtopicInput">Add Subtopics</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="subtopicInput" class="form-control" placeholder="Enter subtopic name">
                                    <button type="button" class="btn btn--primary btn--sm" id="addSubtopicBtn">Add</button>
                                </div>
                            </div>

                            <div class="subtopic-list" id="subtopicList">
                                <!-- Subtopics will be added here -->
                            </div>

                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <button type="submit" class="btn btn--admin" id="saveTopicBtn">Save Topic</button>
                                <button type="button" class="btn btn--outline" id="cancelTopicBtn">Cancel</button>
                            </div>
                        </form>

                        <div id="existingTopics">
                            <h3>Existing Topics</h3>
                            <div id="topicsList">
                                <!-- Existing topics will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin User Progress -->
        <div class="main hidden" id="adminUsers">
            <div class="container">
                <div class="card">
                    <div class="card__header">
                        <h2>User Progress Overview</h2>
                    </div>
                    <div class="card__body">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User Email</th>
                                    <th>Total Progress</th>
                                    <th>Completed Topics</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 2rem;">Loading user data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Tracker App -->
        <div class="main hidden" id="trackerApp">
            <div class="container">
                <!-- Overall Progress Section -->
                <section class="progress-overview">
                    <div class="card">
                        <div class="card__body">
                            <h2>📈 Your Progress</h2>
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-bar__fill" id="overallProgressFill"></div>
                                </div>
                                <span class="progress-percentage" id="overallProgressText">0%</span>
                            </div>
                            <div class="progress-stats">
                                <span id="completedStats">0 of 0 topics completed</span>
                                <span id="lastUpdated">Last updated: Never</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Search Section -->
                <section class="search-section">
                    <div class="form-group">
                        <input type="text" class="form-control" id="searchInput" 
                               placeholder="🔍 Search topics (e.g., Docker, Kubernetes, CI/CD...)">
                    </div>
                </section>

                <!-- Topics Section -->
                <section class="topics-section">
                    <div id="topicsContainer">
                        <div class="loading">Loading topics...</div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 DevOps Preparation Tracker. Built for the DevOps community.</p>
                <p class="footer-links">
                    <a href="https://github.com" target="_blank">GitHub</a> •
                    <a href="https://kubernetes.io/docs" target="_blank">Kubernetes Docs</a> •
                    <a href="https://terraform.io/docs" target="_blank">Terraform Docs</a>
                </p>
            </div>
        </div>
    </footer>

    <script>
// Firebase configuration - YOUR ACTUAL CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyD4adoJJjOAeGLqPBQFZAPWAbneH8uQ",
  authDomain: "devopstracker-5863d.firebaseapp.com",
  projectId: "devopstracker-5863d",
  storageBucket: "devopstracker-5863d.firebasestorage.app",
  messagingSenderId: "359527400053",
  appId: "1:359527400053:web:564b8c6ffc1377a19e2e3c",
  measurementId: "G-XZH6ZS212V"
};

// Admin emails - ADD YOUR ADMIN EMAIL HERE
const ADMIN_EMAILS = [
    'vikasworks.devops@gmail.com'
    // Add more admin emails as needed
];

// Initialize Firebase
let auth = null;
let db = null;

try {
    firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();
    console.log('✅ Firebase initialized successfully');
} catch (error) {
    console.error('❌ Firebase initialization failed:', error);
}

// DevOps Preparation Tracker with Admin Panel
class DevOpsTrackerAdmin {
    constructor() {
        this.user = null;
        this.isAdmin = false;
        this.isSignUp = false;
        this.allExpanded = false;
        this.currentAdminTab = 'dashboard';
        this.currentSubtopics = [];

        // Default DevOps topics data
        this.defaultTopics = [
            {
                "id": "terraform",
                "name": "Terraform",
                "description": "Infrastructure as Code with Terraform",
                "subtopics": [
                    {"id": "terraform-basics", "name": "Terraform Basics & Architecture", "completed": false, "comments": ""},
                    {"id": "iac-concepts", "name": "Infrastructure as Code (IaC) Concepts", "completed": false, "comments": ""},
                    {"id": "terraform-commands", "name": "Terraform Commands & CLI", "completed": false, "comments": ""},
                    {"id": "state-management", "name": "State Management & Remote State", "completed": false, "comments": ""},
                    {"id": "terraform-modules", "name": "Modules & Module Development", "completed": false, "comments": ""},
                    {"id": "variables-datasources", "name": "Variables & Data Sources", "completed": false, "comments": ""},
                    {"id": "providers", "name": "Providers & Provider Configuration", "completed": false, "comments": ""},
                    {"id": "workspaces", "name": "Terraform Workspaces", "completed": false, "comments": ""},
                    {"id": "terraform-security", "name": "Best Practices & Security", "completed": false, "comments": ""},
                    {"id": "terraform-scenarios", "name": "Scenario-Based Questions", "completed": false, "comments": ""}
                ]
            },
            {
                "id": "linux", 
                "name": "Linux",
                "description": "Linux System Administration & Operations",
                "subtopics": [
                    {"id": "linux-fundamentals", "name": "Linux Fundamentals & Architecture", "completed": false, "comments": ""},
                    {"id": "file-system", "name": "File System & Directory Structure", "completed": false, "comments": ""},
                    {"id": "command-line", "name": "Command Line & Shell Scripting", "completed": false, "comments": ""},
                    {"id": "process-management", "name": "Process Management", "completed": false, "comments": ""},
                    {"id": "system-admin", "name": "System Administration", "completed": false, "comments": ""},
                    {"id": "network-config", "name": "Network Configuration", "completed": false, "comments": ""},
                    {"id": "security-permissions", "name": "Security & Permissions", "completed": false, "comments": ""},
                    {"id": "package-management", "name": "Package Management", "completed": false, "comments": ""},
                    {"id": "system-monitoring", "name": "System Monitoring & Troubleshooting", "completed": false, "comments": ""},
                    {"id": "performance-tuning", "name": "Performance Tuning", "completed": false, "comments": ""}
                ]
            },
            {
                "id": "kubernetes",
                "name": "Kubernetes", 
                "description": "Container Orchestration with Kubernetes",
                "subtopics": [
                    {"id": "k8s-architecture", "name": "Kubernetes Architecture & Components", "completed": false, "comments": ""},
                    {"id": "pods-deployments", "name": "Pods, Deployments & Services", "completed": false, "comments": ""},
                    {"id": "configmaps-secrets", "name": "ConfigMaps & Secrets", "completed": false, "comments": ""},
                    {"id": "storage-pv", "name": "Storage & Persistent Volumes", "completed": false, "comments": ""},
                    {"id": "k8s-networking", "name": "Networking & Ingress", "completed": false, "comments": ""},
                    {"id": "rbac-security", "name": "RBAC & Security", "completed": false, "comments": ""},
                    {"id": "monitoring-logging", "name": "Monitoring & Logging", "completed": false, "comments": ""},
                    {"id": "helm", "name": "Helm & Package Management", "completed": false, "comments": ""},
                    {"id": "k8s-troubleshooting", "name": "Troubleshooting & Debugging", "completed": false, "comments": ""},
                    {"id": "k8s-best-practices", "name": "Best Practices & Scenarios", "completed": false, "comments": ""}
                ]
            },
            {
                "id": "jenkins",
                "name": "Jenkins",
                "description": "CI/CD Automation with Jenkins", 
                "subtopics": [
                    {"id": "jenkins-architecture", "name": "Jenkins Architecture & Setup", "completed": false, "comments": ""},
                    {"id": "pipeline-development", "name": "Pipeline Development (Declarative & Scripted)", "completed": false, "comments": ""},
                    {"id": "plugin-management", "name": "Plugin Management", "completed": false, "comments": ""},
                    {"id": "build-deployment", "name": "Build & Deployment Automation", "completed": false, "comments": ""},
                    {"id": "jenkins-security", "name": "Security & User Management", "completed": false, "comments": ""},
                    {"id": "master-slave", "name": "Master-Slave Configuration", "completed": false, "comments": ""},
                    {"id": "git-integration", "name": "Integration with Git & SCM", "completed": false, "comments": ""},
                    {"id": "docker-k8s-integration", "name": "Docker & Kubernetes Integration", "completed": false, "comments": ""},
                    {"id": "jenkins-monitoring", "name": "Monitoring & Troubleshooting", "completed": false, "comments": ""},
                    {"id": "jenkins-best-practices", "name": "Best Practices", "completed": false, "comments": ""}
                ]
            },
            {
                "id": "github",
                "name": "GitHub",
                "description": "Version Control & GitHub Workflows",
                "subtopics": [
                    {"id": "git-fundamentals", "name": "Git Fundamentals & Commands", "completed": false, "comments": ""},
                    {"id": "branching-merging", "name": "Branching & Merging Strategies", "completed": false, "comments": ""},
                    {"id": "github-actions", "name": "GitHub Actions & Workflows", "completed": false, "comments": ""},
                    {"id": "pull-requests", "name": "Pull Requests & Code Review", "completed": false, "comments": ""},
                    {"id": "repo-management", "name": "Repository Management", "completed": false, "comments": ""},
                    {"id": "github-security", "name": "GitHub Security Features", "completed": false, "comments": ""},
                    {"id": "api-integrations", "name": "API & Integrations", "completed": false, "comments": ""},
                    {"id": "team-collaboration", "name": "Collaboration & Team Management", "completed": false, "comments": ""},
                    {"id": "advanced-git", "name": "Advanced Git Operations", "completed": false, "comments": ""},
                    {"id": "git-best-practices", "name": "Best Practices & Troubleshooting", "completed": false, "comments": ""}
                ]
            }
        ];

        this.data = { topics: [] };

        console.log('DevOps Tracker with Admin Panel initialized');
        this.init();
    }

    async init() {
        console.log('Initializing tracker...');

        this.bindEvents();
        this.bindAuthEvents();
        this.bindAdminEvents();

        if (auth) {
            // Listen for auth state changes
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    console.log('User authenticated:', user.email);
                    this.user = user;
                    this.isAdmin = ADMIN_EMAILS.includes(user.email);
                    await this.onUserSignedIn();
                } else {
                    console.log('User signed out');
                    this.user = null;
                    this.isAdmin = false;
                    this.onUserSignedOut();
                }
            });
        } else {
            console.log('Firebase not initialized - running in demo mode');
            this.showLandingPage();
        }

        console.log('Tracker initialized successfully');
    }

    async onUserSignedIn() {
        this.hideAuthModal();
        this.updateNavigation();

        // Load topics first (admin or user)
        await this.loadTopics();

        if (this.isAdmin) {
            this.showAdminDashboard();
            await this.loadAdminData();
        } else {
            this.showTrackerApp();
            if (db) {
                await this.loadProgressFromFirestore();
            }
            this.renderTopics();
            this.updateProgress();
        }
    }

    onUserSignedOut() {
        this.showLandingPage();
        this.updateNavigation();
        this.setSyncStatus('synced', 'Ready');
    }

    showLandingPage() {
        document.getElementById('landingSection').classList.remove('hidden');
        document.getElementById('trackerApp').classList.add('hidden');
        document.getElementById('adminDashboard').classList.add('hidden');
        document.getElementById('adminTopics').classList.add('hidden');
        document.getElementById('adminUsers').classList.add('hidden');
        document.getElementById('adminNav').classList.add('hidden');
        document.getElementById('mainHeader').classList.remove('admin');
        this.updateNavigation();
    }

    showTrackerApp() {
        document.getElementById('landingSection').classList.add('hidden');
        document.getElementById('trackerApp').classList.remove('hidden');
        document.getElementById('adminDashboard').classList.add('hidden');
        document.getElementById('adminTopics').classList.add('hidden');
        document.getElementById('adminUsers').classList.add('hidden');
        document.getElementById('adminNav').classList.add('hidden');
        document.getElementById('mainHeader').classList.remove('admin');
        this.updateNavigation();
    }

    showAdminDashboard() {
        document.getElementById('landingSection').classList.add('hidden');
        document.getElementById('trackerApp').classList.add('hidden');
        document.getElementById('adminDashboard').classList.remove('hidden');
        document.getElementById('adminTopics').classList.add('hidden');
        document.getElementById('adminUsers').classList.add('hidden');
        document.getElementById('adminNav').classList.remove('hidden');
        document.getElementById('mainHeader').classList.add('admin');
        this.currentAdminTab = 'dashboard';
        this.updateAdminNavigation();
        this.updateNavigation();
    }

    showAdminSection(section) {
        // Hide all admin sections
        document.getElementById('adminDashboard').classList.add('hidden');
        document.getElementById('adminTopics').classList.add('hidden');
        document.getElementById('adminUsers').classList.add('hidden');

        // Show selected section
        document.getElementById(`admin${section.charAt(0).toUpperCase() + section.slice(1)}`).classList.remove('hidden');
        this.currentAdminTab = section;
        this.updateAdminNavigation();

        // Load section-specific data
        if (section === 'dashboard') {
            this.loadAdminData();
        } else if (section === 'topics') {
            this.loadAdminTopics();
        } else if (section === 'users') {
            this.loadUsersData();
        }
    }

    updateNavigation() {
        const guestNav = document.getElementById('guestNav');
        const authNav = document.getElementById('authNav');
        const userEmail = document.getElementById('userEmail');
        const adminBadge = document.getElementById('adminBadge');
        const expandAllBtn = document.getElementById('expandAllBtn');
        const exportBtn = document.getElementById('exportBtn');

        if (this.user) {
            guestNav.classList.add('hidden');
            authNav.classList.remove('hidden');
            userEmail.textContent = this.user.email;

            if (this.isAdmin) {
                adminBadge.classList.remove('hidden');
                expandAllBtn.classList.add('hidden');
                exportBtn.classList.add('hidden');
            } else {
                adminBadge.classList.add('hidden');
                expandAllBtn.classList.remove('hidden');
                exportBtn.classList.remove('hidden');
            }
        } else {
            guestNav.classList.remove('hidden');
            authNav.classList.add('hidden');
            adminBadge.classList.add('hidden');
        }
    }

    updateAdminNavigation() {
        document.querySelectorAll('.admin-nav-item').forEach(item => {
            item.classList.remove('active');
        });

        const activeTab = document.getElementById(`admin${this.currentAdminTab.charAt(0).toUpperCase() + this.currentAdminTab.slice(1)}Tab`);
        if (activeTab) {
            activeTab.classList.add('active');
        }
    }

    async loadTopics() {
        if (!db) {
            this.data.topics = [...this.defaultTopics];
            return;
        }

        try {
            const doc = await db.collection('topics').doc('master').get();

            if (doc.exists) {
                const data = doc.data();
                this.data.topics = data.topics || this.defaultTopics;
                console.log('Topics loaded from Firestore');
            } else {
                // Initialize with default topics
                this.data.topics = [...this.defaultTopics];
                await this.saveTopicsToFirestore();
                console.log('Initialized with default topics');
            }
        } catch (error) {
            console.error('Error loading topics:', error);
            this.data.topics = [...this.defaultTopics];
        }
    }

    async saveTopicsToFirestore() {
        if (!db) return;

        try {
            await db.collection('topics').doc('master').set({
                topics: this.data.topics,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            console.log('Topics saved to Firestore');
            this.showToast('Topics updated successfully!', 'success');
        } catch (error) {
            console.error('Error saving topics:', error);
            this.showToast('Failed to save topics', 'error');
        }
    }

    async loadProgressFromFirestore() {
        if (!this.user || !db) return;

        this.setSyncStatus('syncing', 'Loading...');

        try {
            const doc = await db.collection('progress').doc(this.user.uid).get();

            if (doc.exists) {
                const data = doc.data();
                console.log('Progress loaded from Firestore');

                // Merge saved progress with current topics structure
                if (data.topics) {
                    this.mergeProgressWithTopics(data.topics);
                }

                this.setSyncStatus('synced', 'Synced');
            } else {
                console.log('No progress found, creating new document');
                await this.saveProgressToFirestore();
            }
        } catch (error) {
            console.error('Error loading progress:', error);
            this.setSyncStatus('error', 'Load failed');
        }
    }

    mergeProgressWithTopics(savedTopics) {
        // Merge saved progress with current topic structure
        savedTopics.forEach(savedTopic => {
            const currentTopic = this.data.topics.find(t => t.id === savedTopic.id);
            if (currentTopic) {
                savedTopic.subtopics.forEach(savedSubtopic => {
                    const currentSubtopic = currentTopic.subtopics.find(st => st.id === savedSubtopic.id);
                    if (currentSubtopic) {
                        currentSubtopic.completed = savedSubtopic.completed;
                        currentSubtopic.comments = savedSubtopic.comments || '';
                    }
                });
            }
        });
    }

    async saveProgressToFirestore() {
        if (!this.user || !db) return;

        this.setSyncStatus('syncing', 'Saving...');

        try {
            await db.collection('progress').doc(this.user.uid).set({
                topics: this.data.topics,
                userEmail: this.user.email,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            console.log('Progress saved to Firestore');
            this.setSyncStatus('synced', 'Synced');
        } catch (error) {
            console.error('Error saving progress:', error);
            this.setSyncStatus('error', 'Save failed');
        }
    }

    setSyncStatus(status, text) {
        const syncStatus = document.getElementById('syncStatus');
        if (syncStatus) {
            syncStatus.className = `sync-status ${status}`;
            syncStatus.innerHTML = `<span>●</span><span>${text}</span>`;
        }
    }

    // Admin Functions
    async loadAdminData() {
        if (!this.isAdmin || !db) return;

        try {
            // Load all user progress data
            const progressCollection = await db.collection('progress').get();
            const users = [];
            let totalCompletion = 0;

            progressCollection.forEach(doc => {
                const data = doc.data();
                if (data.topics) {
                    const userProgress = this.calculateUserProgress(data.topics);
                    users.push({
                        uid: doc.id,
                        email: data.userEmail || 'Unknown',
                        ...userProgress,
                        lastUpdated: data.updatedAt?.toDate?.() || new Date()
                    });
                    totalCompletion += userProgress.percentage;
                }
            });

            // Update dashboard stats
            const totalTopics = this.data.topics.length;
            const totalSubtopics = this.data.topics.reduce((sum, topic) => sum + topic.subtopics.length, 0);
            const activeUsers = users.length;
            const avgCompletion = activeUsers > 0 ? Math.round(totalCompletion / activeUsers) : 0;

            document.getElementById('totalTopicsCount').textContent = totalTopics;
            document.getElementById('totalSubtopicsCount').textContent = totalSubtopics;
            document.getElementById('activeUsersCount').textContent = activeUsers;
            document.getElementById('avgCompletionRate').textContent = avgCompletion + '%';

            // Show recent activity
            this.showRecentActivity(users);

        } catch (error) {
            console.error('Error loading admin data:', error);
        }
    }

    calculateUserProgress(topics) {
        const totalSubtopics = topics.reduce((sum, topic) => sum + topic.subtopics.length, 0);
        const completedSubtopics = topics.reduce((sum, topic) => 
            sum + topic.subtopics.filter(st => st.completed).length, 0);

        return {
            total: totalSubtopics,
            completed: completedSubtopics,
            percentage: Math.round((completedSubtopics / totalSubtopics) * 100)
        };
    }

    showRecentActivity(users) {
        const recentActivity = document.getElementById('recentActivity');

        if (users.length === 0) {
            recentActivity.innerHTML = '<p>No user activity yet.</p>';
            return;
        }

        // Sort by last updated
        users.sort((a, b) => b.lastUpdated - a.lastUpdated);

        const activityHtml = users.slice(0, 5).map(user => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--color-border);">
                <div>
                    <strong>${user.email}</strong>
                    <div style="font-size: 0.875rem; color: var(--color-text-muted);">
                        ${user.completed}/${user.total} topics completed (${user.percentage}%)
                    </div>
                </div>
                <div style="font-size: 0.875rem; color: var(--color-text-muted);">
                    ${this.formatDate(user.lastUpdated)}
                </div>
            </div>
        `).join('');

        recentActivity.innerHTML = activityHtml;
    }

    async loadUsersData() {
        if (!this.isAdmin || !db) return;

        const tableBody = document.getElementById('usersTableBody');
        tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem;">Loading user data...</td></tr>';

        try {
            const progressCollection = await db.collection('progress').get();
            const users = [];

            progressCollection.forEach(doc => {
                const data = doc.data();
                if (data.topics) {
                    const userProgress = this.calculateUserProgress(data.topics);
                    users.push({
                        uid: doc.id,
                        email: data.userEmail || 'Unknown',
                        ...userProgress,
                        lastUpdated: data.updatedAt?.toDate?.() || new Date(),
                        topics: data.topics
                    });
                }
            });

            if (users.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem;">No user data available</td></tr>';
                return;
            }

            const usersHtml = users.map(user => `
                <tr>
                    <td>${user.email}</td>
                    <td>${user.percentage}%</td>
                    <td>${user.completed}/${user.total}</td>
                    <td>${this.formatDate(user.lastUpdated)}</td>
                    <td>
                        <button class="btn btn--primary btn--sm" onclick="window.tracker.showUserProgress('${user.uid}', '${user.email}')">
                            View Details
                        </button>
                    </td>
                </tr>
            `).join('');

            tableBody.innerHTML = usersHtml;

            // Store users data for user progress modal
            this.usersData = users;

        } catch (error) {
            console.error('Error loading users data:', error);
            tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem;">Error loading user data</td></tr>';
        }
    }

    showUserProgress(userId, userEmail) {
        const user = this.usersData.find(u => u.uid === userId);
        if (!user) return;

        const modal = document.getElementById('userProgressModal');
        const title = document.getElementById('progressModalTitle');
        const content = document.getElementById('progressModalContent');

        title.textContent = `Progress for ${userEmail}`;

        let contentHtml = `
            <div style="margin-bottom: 2rem;">
                <h3>Overall Progress: ${user.percentage}% (${user.completed}/${user.total})</h3>
                <div style="width: 100%; height: 10px; background: var(--color-border); border-radius: 5px; margin: 1rem 0;">
                    <div style="width: ${user.percentage}%; height: 100%; background: var(--color-primary); border-radius: 5px;"></div>
                </div>
            </div>
        `;

        contentHtml += user.topics.map(topic => {
            const completed = topic.subtopics.filter(st => st.completed).length;
            const total = topic.subtopics.length;
            const percentage = Math.round((completed / total) * 100);

            return `
                <div style="margin-bottom: 1.5rem; border: 1px solid var(--color-border); border-radius: 6px; padding: 1rem;">
                    <h4>${topic.name} - ${percentage}% (${completed}/${total})</h4>
                    <div style="margin-top: 0.5rem;">
                        ${topic.subtopics.map(subtopic => `
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin: 0.25rem 0; font-size: 0.875rem;">
                                <span style="color: ${subtopic.completed ? 'var(--color-success)' : 'var(--color-text-muted)'};">
                                    ${subtopic.completed ? '✓' : '○'}
                                </span>
                                <span style="${subtopic.completed ? 'text-decoration: line-through; color: var(--color-text-muted);' : ''}">${subtopic.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }).join('');

        content.innerHTML = contentHtml;
        modal.classList.remove('hidden');
    }

    loadAdminTopics() {
        this.renderAdminTopicsList();
    }

    renderAdminTopicsList() {
        const topicsList = document.getElementById('topicsList');

        if (this.data.topics.length === 0) {
            topicsList.innerHTML = '<p>No topics available. Add some topics to get started.</p>';
            return;
        }

        const topicsHtml = this.data.topics.map(topic => `
            <div class="card" style="margin-bottom: 1rem;">
                <div class="card__body">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h4>${topic.name}</h4>
                            <p style="color: var(--color-text-muted); margin: 0.5rem 0;">${topic.description}</p>
                            <div style="font-size: 0.875rem; color: var(--color-text-muted);">
                                ${topic.subtopics.length} subtopics
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn--outline btn--sm" onclick="window.tracker.editTopic('${topic.id}')">Edit</button>
                            <button class="btn btn--outline-danger btn--sm" onclick="window.tracker.deleteTopic('${topic.id}')">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');

        topicsList.innerHTML = topicsHtml;
    }

    editTopic(topicId) {
        const topic = this.data.topics.find(t => t.id === topicId);
        if (!topic) return;

        // Populate form with topic data
        document.getElementById('topicName').value = topic.name;
        document.getElementById('topicDescription').value = topic.description;

        // Set current subtopics
        this.currentSubtopics = [...topic.subtopics];
        this.renderSubtopicList();

        // Show form and set to edit mode
        document.getElementById('topicForm').classList.remove('hidden');
        document.getElementById('topicForm').dataset.editId = topicId;
        document.getElementById('saveTopicBtn').textContent = 'Update Topic';
    }

    async deleteTopic(topicId) {
        if (!confirm('Are you sure you want to delete this topic? This action cannot be undone.')) {
            return;
        }

        this.data.topics = this.data.topics.filter(t => t.id !== topicId);
        await this.saveTopicsToFirestore();
        this.renderAdminTopicsList();
    }

    formatDate(date) {
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    showToast(message, type = 'success') {
        // Remove existing toast
        const existingToast = document.querySelector('.toast');
        if (existingToast) {
            existingToast.remove();
        }

        // Create new toast
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);

        // Show toast
        setTimeout(() => {
            toast.classList.add('show');
        }, 100);

        // Hide toast
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }

    bindAdminEvents() {
        // Admin navigation
        document.getElementById('adminDashboardTab').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAdminSection('dashboard');
        });

        document.getElementById('adminTopicsTab').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAdminSection('topics');
        });

        document.getElementById('adminUsersTab').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAdminSection('users');
        });

        // Topic management
        document.getElementById('addTopicBtn').addEventListener('click', () => {
            this.showTopicForm();
        });

        document.getElementById('cancelTopicBtn').addEventListener('click', () => {
            this.hideTopicForm();
        });

        document.getElementById('topicForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveTopicForm();
        });

        document.getElementById('addSubtopicBtn').addEventListener('click', () => {
            this.addSubtopic();
        });

        document.getElementById('subtopicInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.addSubtopic();
            }
        });

        // User progress modal
        document.getElementById('closeProgressModal').addEventListener('click', () => {
            document.getElementById('userProgressModal').classList.add('hidden');
        });

        // Close modal when clicking outside
        document.getElementById('userProgressModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                document.getElementById('userProgressModal').classList.add('hidden');
            }
        });
    }

    showTopicForm() {
        document.getElementById('topicForm').classList.remove('hidden');
        document.getElementById('topicForm').removeAttribute('data-edit-id');
        document.getElementById('saveTopicBtn').textContent = 'Save Topic';
        this.currentSubtopics = [];
        this.renderSubtopicList();
        document.getElementById('topicName').focus();
    }

    hideTopicForm() {
        document.getElementById('topicForm').classList.add('hidden');
        document.getElementById('topicForm').reset();
        this.currentSubtopics = [];
        this.renderSubtopicList();
    }

    addSubtopic() {
        const input = document.getElementById('subtopicInput');
        const name = input.value.trim();

        if (!name) return;

        const subtopic = {
            id: this.generateId(name),
            name: name,
            completed: false,
            comments: ""
        };

        this.currentSubtopics.push(subtopic);
        this.renderSubtopicList();
        input.value = '';
        input.focus();
    }

    removeSubtopic(index) {
        this.currentSubtopics.splice(index, 1);
        this.renderSubtopicList();
    }

    renderSubtopicList() {
        const container = document.getElementById('subtopicList');

        if (this.currentSubtopics.length === 0) {
            container.innerHTML = '<p style="color: var(--color-text-muted); font-style: italic;">No subtopics added yet.</p>';
            return;
        }

        const subtopicsHtml = this.currentSubtopics.map((subtopic, index) => `
            <div class="subtopic-item">
                <span>${subtopic.name}</span>
                <button type="button" class="btn btn--outline-danger btn--sm" onclick="window.tracker.removeSubtopic(${index})">Remove</button>
            </div>
        `).join('');

        container.innerHTML = subtopicsHtml;
    }

    async saveTopicForm() {
        const name = document.getElementById('topicName').value.trim();
        const description = document.getElementById('topicDescription').value.trim();

        if (!name || !description) {
            this.showToast('Please fill in all required fields', 'error');
            return;
        }

        if (this.currentSubtopics.length === 0) {
            this.showToast('Please add at least one subtopic', 'error');
            return;
        }

        const editId = document.getElementById('topicForm').dataset.editId;

        if (editId) {
            // Update existing topic
            const topicIndex = this.data.topics.findIndex(t => t.id === editId);
            if (topicIndex !== -1) {
                this.data.topics[topicIndex] = {
                    id: editId,
                    name: name,
                    description: description,
                    subtopics: [...this.currentSubtopics]
                };
            }
        } else {
            // Add new topic
            const newTopic = {
                id: this.generateId(name),
                name: name,
                description: description,
                subtopics: [...this.currentSubtopics]
            };

            this.data.topics.push(newTopic);
        }

        await this.saveTopicsToFirestore();
        this.hideTopicForm();
        this.renderAdminTopicsList();
    }

    generateId(name) {
        return name.toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .trim() + '-' + Date.now();
    }

    // Standard user functions (same as before)
    bindAuthEvents() {
        // Form submission
        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleAuth(e);
        });

        // Auth mode switching
        document.getElementById('authSwitchBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.toggleAuthMode();
        });

        // Show auth modal buttons
        document.getElementById('signInBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal('signin');
        });

        document.getElementById('signUpBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal('signup');
        });

        document.getElementById('getStartedBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal('signup');
        });

        document.getElementById('demoModeBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.startDemoMode();
        });

        // Sign out
        document.getElementById('signOutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.signOut();
        });

        // Close modal
        document.getElementById('closeModal').addEventListener('click', (e) => {
            e.preventDefault();
            this.hideAuthModal();
        });

        // Home link
        document.getElementById('homeLink').addEventListener('click', (e) => {
            e.preventDefault();
            if (this.user) {
                if (this.isAdmin) {
                    this.showAdminDashboard();
                } else {
                    this.showTrackerApp();
                }
            } else {
                this.showLandingPage();
            }
        });
    }

    startDemoMode() {
        console.log('Starting demo mode...');
        this.user = { email: 'demo@example.com', uid: 'demo-user-' + Date.now() };
        this.isAdmin = false;
        this.onUserSignedIn();
    }

    showAuthModal(mode = 'signin') {
        this.isSignUp = mode === 'signup';
        this.updateAuthModalMode();

        const modal = document.getElementById('authModal');
        modal.classList.remove('hidden');

        setTimeout(() => {
            document.getElementById('email').focus();
        }, 100);
    }

    updateAuthModalMode() {
        const authTitle = document.getElementById('authTitle');
        const authSubmit = document.getElementById('authSubmit');
        const authSwitchText = document.getElementById('authSwitchText');
        const authSwitchBtn = document.getElementById('authSwitchBtn');

        if (this.isSignUp) {
            authTitle.textContent = 'Create Account';
            authSubmit.textContent = 'Sign Up';
            authSwitchText.textContent = 'Already have an account?';
            authSwitchBtn.textContent = 'Sign In';
        } else {
            authTitle.textContent = 'Welcome Back';
            authSubmit.textContent = 'Sign In';
            authSwitchText.textContent = "Don't have an account?";
            authSwitchBtn.textContent = 'Sign Up';
        }
    }

    toggleAuthMode() {
        this.isSignUp = !this.isSignUp;
        this.updateAuthModalMode();
        this.clearAuthMessages();
    }

    hideAuthModal() {
        const modal = document.getElementById('authModal');
        modal.classList.add('hidden');
        this.clearAuthForm();
    }

    async handleAuth(e) {
        e.preventDefault();

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        console.log(`Attempting to ${this.isSignUp ? 'sign up' : 'sign in'} user: ${email}`);

        // Demo mode
        if (!auth) {
            if (!email) {
                this.showAuthMessage('error', 'Please enter an email address');
                return;
            }

            console.log('Demo mode - simulating authentication');
            this.user = { email: email, uid: 'demo-user-' + Date.now() };
            this.isAdmin = ADMIN_EMAILS.includes(email);
            this.onUserSignedIn();
            return;
        }

        // Validation
        if (!email || !password) {
            this.showAuthMessage('error', 'Please fill in all required fields');
            return;
        }

        if (password.length < 6) {
            this.showAuthMessage('error', 'Password must be at least 6 characters');
            return;
        }

        this.clearAuthMessages();

        const submitBtn = document.getElementById('authSubmit');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = this.isSignUp ? 'Creating Account...' : 'Signing In...';
        submitBtn.disabled = true;

        try {
            if (this.isSignUp) {
                console.log('Creating account with Firebase Auth');
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                console.log('Account created successfully:', userCredential.user.uid);
            } else {
                console.log('Signing in with Firebase Auth');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('Sign in successful:', userCredential.user.uid);
            }
        } catch (error) {
            console.error('Authentication error:', error);
            this.handleAuthError(error);
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }

    handleAuthError(error) {
        let errorMessage = error.message;

        // User-friendly error messages
        switch (error.code) {
            case 'auth/user-not-found':
                errorMessage = 'No account found with this email. Please sign up first.';
                break;
            case 'auth/wrong-password':
                errorMessage = 'Incorrect password. Please try again.';
                break;
            case 'auth/email-already-in-use':
                errorMessage = 'An account with this email already exists. Try signing in instead.';
                break;
            case 'auth/weak-password':
                errorMessage = 'Password should be at least 6 characters long.';
                break;
            case 'auth/invalid-email':
                errorMessage = 'Please enter a valid email address.';
                break;
            case 'auth/network-request-failed':
                errorMessage = 'Network error. Please check your internet connection.';
                break;
            case 'auth/unauthorized-domain':
                errorMessage = 'This domain is not authorized. Please contact support.';
                break;
            case 'auth/operation-not-allowed':
                errorMessage = 'Email/password authentication is not enabled. Please contact support.';
                break;
            default:
                errorMessage = `Authentication failed: ${error.code}`;
        }

        this.showAuthMessage('error', errorMessage);
    }

    async signOut() {
        console.log('Signing out user...');

        if (!auth) {
            this.user = null;
            this.isAdmin = false;
            this.onUserSignedOut();
            return;
        }

        try {
            await auth.signOut();
            console.log('User signed out successfully');
        } catch (error) {
            console.error('Sign out error:', error);
            alert('Failed to sign out. Please try again.');
        }
    }

    showAuthMessage(type, message) {
        const errorEl = document.getElementById('authError');
        const successEl = document.getElementById('authSuccess');

        if (type === 'error') {
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            successEl.classList.add('hidden');
        } else {
            successEl.textContent = message;
            successEl.classList.remove('hidden');
            errorEl.classList.add('hidden');
        }
    }

    clearAuthMessages() {
        const errorEl = document.getElementById('authError');
        const successEl = document.getElementById('authSuccess');
        errorEl.textContent = '';
        successEl.textContent = '';
        errorEl.classList.add('hidden');
        successEl.classList.add('hidden');
    }

    clearAuthForm() {
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        this.clearAuthMessages();
    }

    bindEvents() {
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterTopics(e.target.value);
            });
        }

        // Expand/Collapse all
        const expandAllBtn = document.getElementById('expandAllBtn');
        if (expandAllBtn) {
            expandAllBtn.addEventListener('click', () => {
                this.toggleAllTopics();
            });
        }

        // Export progress
        const exportBtn = document.getElementById('exportBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', () => {
                this.exportProgress();
            });
        }

        // Click outside modal to close
        const authModal = document.getElementById('authModal');
        authModal.addEventListener('click', (e) => {
            if (e.target === authModal) {
                this.hideAuthModal();
            }
        });
    }

    renderTopics() {
        console.log('Rendering topics...');
        const container = document.getElementById('topicsContainer');
        if (!container) return;

        container.innerHTML = '';

        this.data.topics.forEach((topic) => {
            const completedCount = topic.subtopics.filter(st => st.completed).length;
            const totalCount = topic.subtopics.length;
            const percentage = Math.round((completedCount / totalCount) * 100);

            const topicElement = document.createElement('div');
            topicElement.className = 'topic-section';
            topicElement.setAttribute('data-topic-id', topic.id);

            topicElement.innerHTML = `
                <div class="card">
                    <div class="card__header topic-header" data-topic="${topic.id}">
                        <div class="topic-header__left">
                            <button class="topic-toggle" aria-expanded="false">
                                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="topic-info">
                                <h3 class="topic-title">${topic.name}</h3>
                                <p class="topic-description">${topic.description}</p>
                            </div>
                        </div>
                        <div class="topic-header__right">
                            <div class="progress-indicator">
                                <div class="progress-circle">
                                    <svg class="progress-ring" width="40" height="40">
                                        <circle class="progress-ring__circle" stroke="currentColor" stroke-width="3" 
                                                fill="transparent" r="18" cx="20" cy="20"/>
                                    </svg>
                                    <span class="progress-text">${percentage}%</span>
                                </div>
                                <span class="progress-stats-small">${completedCount}/${totalCount}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card__body topic-content">
                        <div class="subtopics-list">
                            ${topic.subtopics.map(subtopic => `
                                <div class="subtopic-item ${subtopic.completed ? 'completed' : ''}" data-subtopic-id="${subtopic.id}">
                                    <div class="subtopic-header">
                                        <label class="checkbox-label">
                                            <input type="checkbox" ${subtopic.completed ? 'checked' : ''} 
                                                   data-topic="${topic.id}" data-subtopic="${subtopic.id}">
                                            <span class="checkbox-custom"></span>
                                            <span class="subtopic-name">${subtopic.name}</span>
                                        </label>
                                    </div>
                                    <div class="subtopic-comments">
                                        <textarea class="form-control" placeholder="Add your notes and comments here..." 
                                                  data-topic="${topic.id}" data-subtopic="${subtopic.id}">${subtopic.comments || ''}</textarea>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(topicElement);
        });

        this.bindTopicEvents();
    }

    bindTopicEvents() {
        // Topic toggle functionality
        document.querySelectorAll('.topic-header').forEach(header => {
            header.addEventListener('click', (e) => {
                if (e.target.closest('.progress-indicator')) return;

                const topicId = header.getAttribute('data-topic');
                this.toggleTopic(topicId);
            });
        });

        // Checkbox change events
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', async (e) => {
                const topicId = e.target.getAttribute('data-topic');
                const subtopicId = e.target.getAttribute('data-subtopic');
                await this.toggleSubtopic(topicId, subtopicId, e.target.checked);
            });
        });

        // Comment textarea events
        document.querySelectorAll('.subtopic-comments textarea').forEach(textarea => {
            textarea.addEventListener('blur', async (e) => {
                const topicId = e.target.getAttribute('data-topic');
                const subtopicId = e.target.getAttribute('data-subtopic');
                await this.updateSubtopicComment(topicId, subtopicId, e.target.value);
            });
        });
    }

    toggleTopic(topicId) {
        const topicElement = document.querySelector(`[data-topic-id="${topicId}"]`);
        const content = topicElement.querySelector('.topic-content');
        const toggle = topicElement.querySelector('.topic-toggle');
        const isExpanded = content.style.display === 'block';

        if (isExpanded) {
            content.style.display = 'none';
            toggle.setAttribute('aria-expanded', 'false');
        } else {
            content.style.display = 'block';
            toggle.setAttribute('aria-expanded', 'true');
        }
    }

    toggleAllTopics() {
        const expandAllText = document.getElementById('expandAllText');

        this.allExpanded = !this.allExpanded;

        document.querySelectorAll('.topic-section').forEach(topicElement => {
            const content = topicElement.querySelector('.topic-content');
            const toggle = topicElement.querySelector('.topic-toggle');

            if (this.allExpanded) {
                content.style.display = 'block';
                toggle.setAttribute('aria-expanded', 'true');
            } else {
                content.style.display = 'none';
                toggle.setAttribute('aria-expanded', 'false');
            }
        });

        expandAllText.textContent = this.allExpanded ? 'Collapse All' : 'Expand All';
    }

    async toggleSubtopic(topicId, subtopicId, completed) {
        const topic = this.data.topics.find(t => t.id === topicId);
        const subtopic = topic.subtopics.find(st => st.id === subtopicId);

        subtopic.completed = completed;

        // Update UI
        const subtopicElement = document.querySelector(`[data-subtopic-id="${subtopicId}"]`);
        if (completed) {
            subtopicElement.classList.add('completed');
        } else {
            subtopicElement.classList.remove('completed');
        }

        this.updateProgress();

        if (db && !this.isAdmin) {
            await this.saveProgressToFirestore();
        }
    }

    async updateSubtopicComment(topicId, subtopicId, comment) {
        const topic = this.data.topics.find(t => t.id === topicId);
        const subtopic = topic.subtopics.find(st => st.id === subtopicId);

        subtopic.comments = comment;

        if (db && !this.isAdmin) {
            await this.saveProgressToFirestore();
        }
    }

    updateProgress() {
        const totalSubtopics = this.data.topics.reduce((sum, topic) => sum + topic.subtopics.length, 0);
        const completedSubtopics = this.data.topics.reduce((sum, topic) => 
            sum + topic.subtopics.filter(st => st.completed).length, 0);

        const overallPercentage = Math.round((completedSubtopics / totalSubtopics) * 100);

        // Update overall progress
        const progressFill = document.getElementById('overallProgressFill');
        const progressText = document.getElementById('overallProgressText');
        const completedStats = document.getElementById('completedStats');
        const lastUpdated = document.getElementById('lastUpdated');

        if (progressFill) progressFill.style.width = `${overallPercentage}%`;
        if (progressText) progressText.textContent = `${overallPercentage}%`;
        if (completedStats) completedStats.textContent = `${completedSubtopics} of ${totalSubtopics} topics completed`;
        if (lastUpdated) lastUpdated.textContent = `Last updated: ${new Date().toLocaleString()}`;

        // Update individual topic progress circles
        this.data.topics.forEach(topic => {
            const completedCount = topic.subtopics.filter(st => st.completed).length;
            const totalCount = topic.subtopics.length;
            const percentage = Math.round((completedCount / totalCount) * 100);

            const progressCircle = document.querySelector(`[data-topic-id="${topic.id}"] .progress-circle`);
            if (progressCircle) {
                const circle = progressCircle.querySelector('.progress-ring__circle');
                const text = progressCircle.querySelector('.progress-text');
                const stats = progressCircle.parentElement.querySelector('.progress-stats-small');

                if (circle && text && stats) {
                    const radius = 18;
                    const circumference = radius * 2 * Math.PI;
                    const offset = circumference - (percentage / 100) * circumference;

                    circle.style.strokeDasharray = circumference;
                    circle.style.strokeDashoffset = offset;

                    text.textContent = `${percentage}%`;
                    stats.textContent = `${completedCount}/${totalCount}`;
                }
            }
        });
    }

    filterTopics(searchTerm) {
        const normalizedSearch = searchTerm.toLowerCase().trim();

        document.querySelectorAll('.topic-section').forEach(topicElement => {
            const topicName = topicElement.querySelector('.topic-title').textContent.toLowerCase();
            const subtopics = Array.from(topicElement.querySelectorAll('.subtopic-name')).map(el => el.textContent.toLowerCase());

            const topicMatches = topicName.includes(normalizedSearch);
            const subtopicMatches = subtopics.some(subtopic => subtopic.includes(normalizedSearch));

            if (normalizedSearch === '' || topicMatches || subtopicMatches) {
                topicElement.style.display = 'block';

                if (normalizedSearch !== '' && subtopicMatches) {
                    const content = topicElement.querySelector('.topic-content');
                    const toggle = topicElement.querySelector('.topic-toggle');
                    content.style.display = 'block';
                    toggle.setAttribute('aria-expanded', 'true');
                }
            } else {
                topicElement.style.display = 'none';
            }
        });
    }

    exportProgress() {
        if (!this.user) return;

        const totalSubtopics = this.data.topics.reduce((sum, topic) => sum + topic.subtopics.length, 0);
        const completedSubtopics = this.data.topics.reduce((sum, topic) => 
            sum + topic.subtopics.filter(st => st.completed).length, 0);

        let exportText = `DevOps Preparation Progress Report - ${this.user.email || this.user.uid}\n`;
        exportText += `Generated: ${new Date().toLocaleString()}\n`;
        exportText += `Overall Progress: ${completedSubtopics}/${totalSubtopics} (${Math.round((completedSubtopics / totalSubtopics) * 100)}%)\n\n`;

        this.data.topics.forEach(topic => {
            const completed = topic.subtopics.filter(st => st.completed).length;
            const total = topic.subtopics.length;
            const percentage = Math.round((completed / total) * 100);

            exportText += `${topic.name}: ${completed}/${total} (${percentage}%)\n`;

            topic.subtopics.forEach(subtopic => {
                const status = subtopic.completed ? '✓' : '○';
                exportText += `  ${status} ${subtopic.name}`;
                if (subtopic.comments) {
                    exportText += ` - ${subtopic.comments}`;
                }
                exportText += '\n';
            });
            exportText += '\n';
        });

        // Create and download file
        const blob = new Blob([exportText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `devops-prep-progress-${(this.user.email || this.user.uid).split('@')[0]}-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing DevOps Tracker with Admin Panel...');

    try {
        window.tracker = new DevOpsTrackerAdmin();
    } catch (error) {
        console.error('Failed to initialize DevOps Tracker:', error);
        document.body.innerHTML = `
            <div style="padding: 2rem; text-align: center;">
                <h2>❌ Failed to Load</h2>
                <p>DevOps Tracker failed to initialize. Please refresh the page.</p>
                <p style="color: #dc2626; font-size: 0.9rem;">${error.message}</p>
            </div>
        `;
    }
});
    </script>
</body>
</html>
